{"version":3,"file":"autoComplete.stories-ec459045.js","sources":["../../src/hooks/useDebounce.tsx","../../src/components/AutoComplete/autoComplete.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction useDebounce(value: any, delay = 300) {\n  const [debounceValue, setDebounceValue] = useState(value)\n\n  useEffect(() => {\n    const handler = window.setTimeout(() => {\n      setDebounceValue(value)\n    }, delay)\n\n    return () => {\n      clearTimeout(handler)\n    }\n  }, [value, delay])\n\n  return debounceValue\n}\n\nexport default useDebounce\n","import { useState, useEffect, useRef } from 'react'\nimport classNames from 'classnames'\nimport Input from '@/components/Input/input'\nimport Icon from '@/components/Icon'\nimport Transition from '@/components/Transition'\nimport useDebounce from '@/hooks/useDebounce'\nimport useClickOutside from '@/hooks/useClickOutside'\nimport type { FC, ChangeEvent, KeyboardEvent, ReactElement } from 'react'\nimport type { InputProps } from '@/components/Input/input'\n\ninterface DataSourceObject {\n  value: string\n}\n\nexport type DataSourceType<T = object> = T & DataSourceObject\n\nexport interface AutoCompleteProps\n  extends Omit<InputProps, 'onSelect' | 'onChange'> {\n  fetchSuggestions: (\n    str: string\n  ) => DataSourceType[] | Promise<DataSourceType[]>\n  onChange?: (value: string) => void\n  onSelect?: (item: DataSourceType) => void\n  renderOption?: (item: DataSourceType) => ReactElement\n}\n\nexport const AutoComplete: FC<AutoCompleteProps> = props => {\n  const {\n    value,\n    fetchSuggestions,\n    renderOption,\n    onSelect,\n    onChange,\n    ...restProps\n  } = props\n\n  const [inputValue, setInputValue] = useState(value as string)\n  const [suggestions, setSuggestions] = useState<DataSourceType[]>([])\n  const [loading, setLoading] = useState(false)\n  const [showDropdown, setShowDropdown] = useState(false)\n  const [highlightIndex, setHighlightIndex] = useState(-1)\n\n  const triggerSearch = useRef(false)\n\n  const componentRef = useRef<HTMLDivElement>(null)\n\n  const debounceValue = useDebounce(inputValue)\n\n  useClickOutside(componentRef, () => {\n    setSuggestions([])\n    setShowDropdown(false)\n  })\n\n  useEffect(() => {\n    if (debounceValue && triggerSearch.current) {\n      setSuggestions([])\n      const result = fetchSuggestions(debounceValue)\n      if (result instanceof Promise) {\n        setLoading(true)\n        result.then(data => {\n          setLoading(false)\n          setSuggestions(data)\n          if (data.length > 0) {\n            setShowDropdown(true)\n          }\n        })\n      } else {\n        setSuggestions(result)\n        if (result.length > 0) {\n          setShowDropdown(true)\n        }\n      }\n    } else {\n      setSuggestions([])\n      setShowDropdown(false)\n    }\n    setHighlightIndex(-1)\n  }, [debounceValue, fetchSuggestions])\n\n  const highlight = (index: number) => {\n    if (index < 0) index = 0\n    if (index >= suggestions.length) {\n      index = suggestions.length - 1\n    }\n    setHighlightIndex(index)\n  }\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    switch (e.code) {\n      case 'Enter':\n        if (suggestions[highlightIndex]) {\n          handleSelect(suggestions[highlightIndex])\n        }\n        break\n      case 'ArrowUp':\n        highlight(highlightIndex - 1)\n        break\n      case 'ArrowDown':\n        highlight(highlightIndex + 1)\n        break\n      case 'Escape':\n        setSuggestions([])\n        setShowDropdown(false)\n        break\n      default:\n        break\n    }\n  }\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.trim()\n    setInputValue(value)\n    if (onChange) {\n      onChange(value)\n    }\n    triggerSearch.current = true\n  }\n\n  const handleSelect = (item: DataSourceType) => {\n    setInputValue(item.value)\n    setSuggestions([])\n    setShowDropdown(false)\n    if (onSelect) {\n      onSelect(item)\n    }\n    triggerSearch.current = false\n  }\n\n  const renderTemplate = (item: DataSourceType) => {\n    return renderOption ? renderOption(item) : item.value\n  }\n\n  const generateDropdown = () => {\n    return (\n      <Transition\n        in={showDropdown || loading}\n        animation=\"zoom-in-top\"\n        timeout={300}\n        onExited={() => {\n          setSuggestions([])\n        }}\n      >\n        <ul className=\"a-suggestion-list\">\n          {loading && (\n            <div className=\"suggestion-loading-icon\">\n              <Icon icon=\"spinner\" spin />\n            </div>\n          )}\n          {suggestions.map((item, index) => {\n            const classes = classNames('suggestion-item', {\n              'is-active': index === highlightIndex\n            })\n            return (\n              <li\n                key={index}\n                className={classes}\n                onClick={() => handleSelect(item)}\n              >\n                {renderTemplate(item)}\n              </li>\n            )\n          })}\n        </ul>\n      </Transition>\n    )\n  }\n\n  return (\n    <div className=\"a-auto-complete\" ref={componentRef}>\n      <Input\n        {...restProps}\n        value={inputValue}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n      />\n      {generateDropdown()}\n    </div>\n  )\n}\n\nexport default AutoComplete\n"],"names":["useDebounce","value","delay","debounceValue","setDebounceValue","useState","useEffect","handler","AutoComplete","props","fetchSuggestions","renderOption","onSelect","onChange","restProps","inputValue","setInputValue","suggestions","setSuggestions","loading","setLoading","showDropdown","setShowDropdown","highlightIndex","setHighlightIndex","triggerSearch","useRef","componentRef","useClickOutside","result","data","highlight","index","handleKeyDown","handleSelect","handleChange","value2","item","renderTemplate","generateDropdown","jsx","Transition","jsxs","Icon","classes","classNames","Input","AutoComplete$1"],"mappings":"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"}